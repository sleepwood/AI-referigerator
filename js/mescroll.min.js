/*
 * mescroll -- 精致的下拉刷新和上拉加载js框架  ( a great JS framework for pull-refresh and pull-up-loading )
 * version 1.1.6
 * 2017-08-27
 * https://github.com/mescroll/mescroll.git
 * http://www.mescroll.com
 * author: wenju < mescroll@qq.com > 文举
 */
(function(a,b){var c=typeof define==="function",d=typeof module!=="undefined"&&module.exports;if(c){define(b)}else{if(d){module.exports=b()}else{this[a]=b()}}})("MeScroll",function(){function a(b,c){this.scrollDom=document.getElementById(b);this.options=c||{};this.isDownScrolling=false;this.isUpScrolling=false;this.initDownScroll();this.initUpScroll();var d=this;setTimeout(function(){if(d.optDown.auto){if(d.optDown.autoShowLoading){d.triggerDownScroll()}else{d.optDown.callback&&d.optDown.callback(d)}}d.optUp.auto&&d.triggerUpScroll()},30)}a.prototype.extendDownScroll=function(c){var b=!!navigator.userAgent.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/);a.extend(c,{use:true,auto:true,autoShowLoading:false,isLock:false,isBoth:false,offset:80,outOffsetRate:0.2,minAngle:45,mustToTop:!b,hardwareClass:"mescroll-hardware",warpClass:"mescroll-downwarp",resetClass:"mescroll-downwarp-reset",htmlContent:'<p class="downwarp-progress"></p><p class="downwarp-tip">下拉刷新 </p>',inited:function(e,d){e.downTipDom=d.getElementsByClassName("downwarp-tip")[0];e.downProgressDom=d.getElementsByClassName("downwarp-progress")[0]},inOffset:function(d){if(d.downTipDom){d.downTipDom.innerHTML="下拉刷新"}if(d.downProgressDom){d.downProgressDom.classList.remove("mescroll-rotate")}},outOffset:function(d){if(d.downTipDom){d.downTipDom.innerHTML="释放更新"}},onMoving:function(e,g,d){if(e.downProgressDom){var f=360*g;e.downProgressDom.style.webkitTransform="rotate("+f+"deg)";e.downProgressDom.style.transform="rotate("+f+"deg)"}},beforeLoading:function(e,d){return false},showLoading:function(d){if(d.downTipDom){d.downTipDom.innerHTML="加载中 ..."}if(d.downProgressDom){d.downProgressDom.classList.add("mescroll-rotate")}},callback:function(d){d.resetUpScroll()}})};a.prototype.extendUpScroll=function(b){var c=typeof window.orientation=="undefined";a.extend(b,{use:true,auto:false,isLock:false,isBoth:false,callback:null,page:{num:0,size:10,time:null},noMoreSize:5,offset:100,toTop:{src:null,offset:1000,warpClass:"mescroll-totop",showClass:"mescroll-fade-in",hideClass:"mescroll-fade-out",duration:300},loadFull:{use:false,delay:500},empty:{warpId:null,icon:null,tip:"暂无相关数据~",btntext:"",btnClick:null},clearId:null,clearEmptyId:null,hardwareClass:"mescroll-hardware",warpClass:"mescroll-upwarp",htmlLoading:'<p class="upwarp-progress mescroll-rotate"></p><p class="upwarp-tip">加载中..</p>',htmlNodata:'<p class="upwarp-nodata">-- END --</p>',inited:function(d,e){},showLoading:function(d,e){e.innerHTML=d.optUp.htmlLoading},showNoMore:function(d,e){e.innerHTML=d.optUp.htmlNodata},onScroll:null,scrollbar:{use:c,barClass:"mescroll-bar"}})};a.extend=function(c,b){if(!c){return b}for(key in b){if(c[key]==null){c[key]=b[key]}else{if(typeof c[key]=="object"){a.extend(c[key],b[key])}}}return c};a.prototype.initDownScroll=function(){var d=this;d.optDown=d.options.down||{};if(d.optDown.use==false){return}d.extendDownScroll(d.optDown);d.downwarp=document.createElement("div");d.downwarp.className=d.optDown.warpClass;d.downwarp.innerHTML='<div class="downwarp-content">'+d.optDown.htmlContent+"</div>";d.scrollDom.insertBefore(d.downwarp,d.scrollDom.firstChild);d.scrollDom.addEventListener("touchstart",c);d.scrollDom.addEventListener("mousedown",c);function c(f){if(d.isScrollTo){f.preventDefault()}d.startTop=d.scrollDom.scrollTop;if(d.optDown.mustToTop){d.startY=f.touches?f.touches[0].pageY:f.clientY}}d.scrollDom.addEventListener("touchmove",b);d.scrollDom.addEventListener("mousemove",b);function b(k){if(d.startTop!=null&&d.scrollDom.scrollTop<=0&&!d.isDownScrolling&&(!d.isUpScrolling||(d.isUpScrolling&&d.optUp.isBoth))&&!d.optDown.isLock){if(d.optDown.mustToTop&&d.startTop>0){return}var g=k.touches?k.touches[0].pageX:k.clientX;var f=k.touches?k.touches[0].pageY:k.clientY;if(!d.preX){d.preX=g}if(!d.preY){d.preY=f}var n=Math.abs(d.preX-g);var m=Math.abs(d.preY-f);var l=Math.sqrt(n*n+m*m);var o=f-d.preY;d.preX=g;d.preY=f;if(l!=0){var i=Math.asin(m/l)/Math.PI*180;if(i<d.optDown.minAngle){return}}if(!d.startY&&!d.optDown.mustToTop){d.startY=f}var h=f-d.startY;if(h>0){k.preventDefault();if(!d.downHight){d.downHight=0}if(d.downHight<d.optDown.offset){if(d.movetype!=1){d.movetype=1;d.optDown.inOffset(d);d.downwarp.classList.remove(d.optDown.resetClass);d.scrollDom.classList.add(d.optDown.hardwareClass);d.scrollDom.style.webkitOverflowScrolling="auto";d.isMoveDown=true}d.downHight+=o}else{if(d.movetype!=2){d.movetype=2;d.optDown.outOffset(d);d.downwarp.classList.remove(d.optDown.resetClass);d.scrollDom.classList.add(d.optDown.hardwareClass);d.scrollDom.style.webkitOverflowScrolling="auto";d.isMoveDown=true}if(o>0){d.downHight+=o*d.optDown.outOffsetRate}else{d.downHight+=o}}d.downwarp.style.height=d.downHight+"px";var j=d.downHight/d.optDown.offset;d.optDown.onMoving(d,j,d.downHight)}}}d.scrollDom.addEventListener("touchend",e);d.scrollDom.addEventListener("mouseup",e);d.scrollDom.addEventListener("mouseleave",e);function e(f){if(d.isMoveDown){if(d.downHight>=d.optDown.offset){d.triggerDownScroll()}else{d.downwarp.classList.add(d.optDown.resetClass);d.downHight=0;d.downwarp.style.height=0}d.scrollDom.style.webkitOverflowScrolling="touch";d.scrollDom.classList.remove(d.optDown.hardwareClass);d.movetype=0;d.isMoveDown=false}d.startY=0;d.preX=0;d.preY=0;d.startTop=null}setTimeout(function(){d.optDown.inited(d,d.downwarp)},0)};a.prototype.triggerDownScroll=function(){if(!this.optDown.beforeLoading(this,this.downwarp)){this.showDownScroll();this.optDown.callback&&this.optDown.callback(this)}};a.prototype.showDownScroll=function(){this.isDownScrolling=true;this.optDown.showLoading(this);this.downHight=this.optDown.offset;this.downwarp.classList.add(this.optDown.resetClass);this.downwarp.style.height=this.optDown.offset+"px"};a.prototype.endDownScroll=function(){this.downHight=0;this.downwarp.style.height=0;this.isDownScrolling=false};a.prototype.lockDownScroll=function(b){if(b==null){b=true}this.optDown.isLock=b};a.prototype.initUpScroll=function(){var b=this;b.optUp=b.options.up||{};if(b.optUp.use==false){return}b.extendUpScroll(b.optUp);if(b.optUp.scrollbar.use){b.scrollDom.classList.add(b.optUp.scrollbar.barClass)}b.upwarp=document.createElement("div");b.upwarp.className=b.optUp.warpClass;b.scrollDom.appendChild(b.upwarp);b.scrollDom.addEventListener("scroll",function(){var d=b.scrollDom.scrollTop;if(!b.isUpScrolling&&(!b.isDownScrolling||(b.isDownScrolling&&b.optDown.isBoth))){if(!b.optUp.isLock){var c=b.scrollDom.scrollHeight-b.scrollDom.clientHeight-d;if(c<=b.optUp.offset){b.triggerUpScroll()}}if(b.optUp.toTop.src){if(d>=b.optUp.toTop.offset){b.showTopBtn()}else{b.hideTopBtn()}}}b.optUp.onScroll&&b.optUp.onScroll(b,d)});setTimeout(function(){b.optUp.inited(b,b.upwarp)},0)};a.prototype.triggerUpScroll=function(){this.showUpScroll();this.optUp.page.num++;this.optUp.callback&&this.optUp.callback(this.optUp.page,this)};a.prototype.showUpScroll=function(){this.isUpScrolling=true;this.upwarp.classList.add(this.optUp.hardwareClass);this.upwarp.style.visibility="visible";this.optUp.showLoading(this,this.upwarp)};a.prototype.showNoMore=function(){this.upwarp.style.visibility="visible";this.optUp.isLock=true;this.optUp.showNoMore(this,this.upwarp)};a.prototype.hideUpScroll=function(){this.upwarp.style.visibility="hidden";this.upwarp.classList.remove(this.optUp.hardwareClass)};a.prototype.endUpScroll=function(b){if(b!=null){if(b){this.showNoMore()}else{this.hideUpScroll()}}this.isUpScrolling=false};a.prototype.resetUpScroll=function(c){if(this.optUp&&this.optUp.use){var b=this.optUp.page;this.prePageNum=b.num;this.prePageTime=b.time;b.num=1;b.time=null;if(!this.isDownScrolling&&c!=false){if(c==null){this.removeEmpty();this.clearDataList();this.showUpScroll()}else{this.showDownScroll()}}this.optUp.callback&&this.optUp.callback(b,this)}};a.prototype.clearDataList=function(){var c=this.optUp.clearId||this.optUp.clearEmptyId;if(c){var b=document.getElementById(c);if(b){b.innerHTML=""}}};a.prototype.endSuccess=function(c,e){if(this.isDownScrolling){this.endDownScroll()}if(this.optUp.use){var f=this.optUp.page.num;var b=this.optUp.page.size;if(f==1){this.clearDataList()}var d;if(c!=null){if(c<b){this.optUp.isLock=true;if(c==0&&f==1){d=false;this.showEmpty()}else{var g=(f-1)*b+c;if(g<this.optUp.noMoreSize){d=false}else{d=true}this.removeEmpty()}}else{d=false;this.optUp.isLock=false;this.removeEmpty()}}if(f==1&&e){this.optUp.page.time=e}this.endUpScroll(d);this.loadFull()}};a.prototype.endErr=function(){if(this.isDownScrolling){var b=this.optUp.page;if(b&&this.prePageNum){b.num=this.prePageNum;b.time=this.prePageTime}this.endDownScroll()}if(this.isUpScrolling){this.optUp.page.num--;this.endUpScroll(false)}};a.prototype.loadFull=function(){var b=this;if(b.optUp.loadFull.use&&!b.optUp.isLock&&b.scrollDom.scrollHeight<=b.scrollDom.clientHeight){setTimeout(function(){if(b.scrollDom.scrollHeight<=b.scrollDom.clientHeight){b.triggerUpScroll()}},b.optUp.loadFull.delay)}};a.prototype.lockUpScroll=function(b){if(b==null){b=true}this.optUp.isLock=b};a.prototype.showEmpty=function(){var c=this;var d=c.optUp.empty;var b=d.warpId||c.optUp.clearEmptyId;if(b==null){return}var g=document.getElementById(b);if(g){c.removeEmpty();var f="";if(d.icon){f+='<img class="empty-icon" src="'+d.icon+'"/>'}if(d.tip){f+='<p class="empty-tip">'+d.tip+"</p>"}if(d.btntext){f+='<p class="empty-btn">'+d.btntext+"</p>"}c.emptyDom=document.createElement("div");c.emptyDom.className="mescroll-empty";c.emptyDom.innerHTML=f;g.appendChild(c.emptyDom);if(d.btnClick){var e=c.emptyDom.getElementsByClassName("empty-btn")[0];e.onclick=function(){d.btnClick()}}}};a.prototype.removeEmpty=function(){if(this.emptyDom){var b=this.emptyDom.parentNode;if(b){b.removeChild(this.emptyDom)}this.emptyDom=null}};a.prototype.showTopBtn=function(){if(!this.topBtnShow){this.topBtnShow=true;var b=this;var c=b.optUp.toTop;if(b.toTopBtn==null){b.toTopBtn=document.createElement("img");b.toTopBtn.className=c.warpClass;b.toTopBtn.src=c.src;b.toTopBtn.onclick=function(){b.scrollTo(0,b.optUp.toTop.duration)};document.body.appendChild(b.toTopBtn)}b.toTopBtn.classList.remove(c.hideClass);b.toTopBtn.classList.add(c.showClass)}};a.prototype.hideTopBtn=function(){if(this.topBtnShow&&this.toTopBtn){this.topBtnShow=false;this.toTopBtn.classList.remove(this.optUp.toTop.showClass);this.toTopBtn.classList.add(this.optUp.toTop.hideClass)}};a.prototype.scrollTo=function(j,l){l=l||300;var g=20;var f=l/g;var h=this;var b=h.scrollDom.scrollHeight-h.scrollDom.clientHeight;if(j<0){j=0}if(j>b){j=b}var k=h.scrollDom.scrollTop-j;if(k==0){return}var c=k/f;h.isScrollTo=true;var d=0;var e=window.setInterval(function(){if(d<f){if(d==f-1){h.scrollDom.scrollTop=j}else{h.scrollDom.scrollTop-=c}d++}else{h.isScrollTo=false;window.clearInterval(e)}},g)};return a});